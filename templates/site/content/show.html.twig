{% extends 'base.html.twig' %}

{% block title %}{{ post.title|raw }} - {{ site.name }} - Affilio{% endblock %}

{% block content %}
{# Header #}
<div class="mb-8">
    <a href="{{ path('app_site_content', {id: site.id}) }}" class="inline-flex items-center gap-2 text-slate-500 hover:text-slate-700 transition-colors mb-4">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Retour au contenu
    </a>

    <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4">
        <div class="flex-1">
            <div class="flex items-center gap-2 mb-3">
                {# Status badge #}
                {% if post.status == 'publish' %}
                    <span class="px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-600 text-xs font-medium">Publie</span>
                {% elseif post.status == 'draft' %}
                    <span class="px-2 py-0.5 rounded-full bg-amber-100 text-amber-600 text-xs font-medium">Brouillon</span>
                {% else %}
                    <span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-500 text-xs font-medium">{{ post.status }}</span>
                {% endif %}

                {# Type badge #}
                <span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-500 text-xs">
                    {{ post.type == 'page' ? 'Page' : 'Article' }}
                </span>

                {% if connector %}
                    <span class="px-2 py-0.5 rounded-lg text-xs font-medium
                        {% if site.type == 'wordpress' %}bg-blue-100 text-blue-600
                        {% elseif site.type == 'api' %}bg-purple-100 text-purple-600
                        {% else %}bg-orange-100 text-orange-600{% endif %}">
                        {{ connector.name }}
                    </span>
                {% endif %}
            </div>

            <h1 class="text-2xl lg:text-3xl font-bold text-slate-800 mb-3">{{ post.title|raw }}</h1>

            <div class="flex flex-wrap items-center gap-4 text-sm text-slate-500">
                {% if post.author %}
                    <div class="flex items-center gap-2">
                        {% if post.author.avatar %}
                            <img src="{{ post.author.avatar }}" alt="{{ post.author.name }}" class="w-6 h-6 rounded-full">
                        {% endif %}
                        <span>{{ post.author.name }}</span>
                    </div>
                {% endif %}

                {% if post.date %}
                    <div class="flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>Publie le {{ post.date|date('d/m/Y a H:i') }}</span>
                    </div>
                {% endif %}

                {% if post.modified %}
                    <div class="flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        <span>Modifie le {{ post.modified|date('d/m/Y') }}</span>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="flex items-center gap-3">
            {% if post.url %}
                <a href="{{ post.url }}" target="_blank"
                   class="btn-secondary flex items-center gap-2 px-4 py-2.5 rounded-xl">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                    </svg>
                    Voir sur le site
                </a>
            {% endif %}
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    {# Main Content #}
    <div class="lg:col-span-2 space-y-6">
        {# Featured Image #}
        {% if post.featured_image %}
            <div class="card rounded-2xl overflow-hidden">
                <img src="{{ post.featured_image }}" alt="{{ post.title|raw }}" class="w-full h-auto">
            </div>
        {% endif %}

        {# Excerpt #}
        {% if post.excerpt %}
            <div class="card rounded-2xl p-6">
                <h2 class="text-lg font-semibold text-slate-800 mb-3">Resume</h2>
                <p class="text-slate-600 italic">{{ post.excerpt }}</p>
            </div>
        {% endif %}

        {# Content #}
        <div class="card rounded-2xl p-6">
            <h2 class="text-lg font-semibold text-slate-800 mb-4">Contenu</h2>
            <div class="prose prose-slate prose-sm max-w-none">
                <div class="text-slate-700 article-content">
                    {{ post.content|raw }}
                </div>
            </div>
        </div>
    </div>

    {# Sidebar #}
    <div class="space-y-6">
        {# Meta Info #}
        <div class="card rounded-2xl p-6">
            <h2 class="text-lg font-semibold text-slate-800 mb-4">Informations</h2>
            <div class="space-y-4">
                <div>
                    <p class="text-slate-500 text-sm">ID</p>
                    <p class="text-slate-800 font-mono">{{ post.id }}</p>
                </div>

                {% if post.slug %}
                    <div>
                        <p class="text-slate-500 text-sm">Slug</p>
                        <p class="text-slate-800 font-mono text-sm break-all">{{ post.slug }}</p>
                    </div>
                {% endif %}

                <div>
                    <p class="text-slate-500 text-sm">Statut</p>
                    <p class="text-slate-800 capitalize">{{ post.status }}</p>
                </div>

                <div>
                    <p class="text-slate-500 text-sm">Type</p>
                    <p class="text-slate-800 capitalize">{{ post.type }}</p>
                </div>
            </div>
        </div>

        {# Categories #}
        {% if post.categories|length > 0 %}
            <div class="card rounded-2xl p-6">
                <h2 class="text-lg font-semibold text-slate-800 mb-4">Categories</h2>
                <div class="flex flex-wrap gap-2">
                    {% for category in post.categories %}
                        <span class="px-3 py-1 rounded-lg bg-primary-100 text-primary-600 text-sm">
                            {{ category.name }}
                        </span>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        {# Tags #}
        {% if post.tags|length > 0 %}
            <div class="card rounded-2xl p-6">
                <h2 class="text-lg font-semibold text-slate-800 mb-4">Tags</h2>
                <div class="flex flex-wrap gap-2">
                    {% for tag in post.tags %}
                        <span class="px-3 py-1 rounded-lg bg-slate-100 text-slate-600 text-sm">
                            #{{ tag.name }}
                        </span>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        {# Quick Actions #}
        <div class="card rounded-2xl p-6">
            <h2 class="text-lg font-semibold text-slate-800 mb-4">Actions</h2>
            <div class="space-y-3">
                {% if post.url %}
                    <a href="{{ post.url }}" target="_blank"
                       class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition-colors group">
                        <div class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                            <svg class="w-5 h-5 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-slate-800">Voir sur le site</p>
                            <p class="text-xs text-slate-500">Ouvrir dans un nouvel onglet</p>
                        </div>
                    </a>
                {% endif %}

                {% if site.type == 'wordpress' %}
                    <a href="{{ site.url }}/wp-admin/post.php?post={{ post.id }}&action=edit" target="_blank"
                       class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition-colors group">
                        <div class="w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center group-hover:bg-amber-200 transition-colors">
                            <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-slate-800">Modifier dans WordPress</p>
                            <p class="text-xs text-slate-500">Ouvrir l'editeur WordPress</p>
                        </div>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.article-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.75rem;
    margin: 1rem 0;
}
.article-content p {
    margin-bottom: 1rem;
}
.article-content h1, .article-content h2, .article-content h3, .article-content h4 {
    color: #1e293b;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
}
.article-content h1 { font-size: 1.5rem; }
.article-content h2 { font-size: 1.25rem; }
.article-content h3 { font-size: 1.125rem; }
.article-content a {
    color: #22c55e;
}
.article-content a:hover {
    text-decoration: underline;
}
.article-content ul, .article-content ol {
    padding-left: 1.5rem;
    margin-bottom: 1rem;
}
.article-content li {
    margin-bottom: 0.25rem;
}
.article-content blockquote {
    border-left: 3px solid rgba(34, 197, 94, 0.5);
    padding-left: 1rem;
    margin: 1rem 0;
    color: #64748b;
    font-style: italic;
}
.article-content pre {
    background: #f1f5f9;
    padding: 1rem;
    border-radius: 0.75rem;
    overflow-x: auto;
    margin: 1rem 0;
}
.article-content code {
    font-family: monospace;
    font-size: 0.875rem;
}
</style>
{% endblock %}
